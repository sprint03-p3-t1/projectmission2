# 리트리버 시스템

한국어 문서 검색을 위한 모듈화된 하이브리드 검색 시스템입니다.

## 🌟 주요 기능

- **하이브리드 검색**: 벡터 유사도 + BM25 + 재순위화를 결합한 고성능 검색
- **스마트 필터링**: 자연어 쿼리에서 자동으로 필터 조건 추출
- **한국어 최적화**: Kiwi, KoNLPy 등 한국어 토크나이저 지원
- **비동기 처리**: 대용량 문서 로딩을 위한 비동기 I/O
- **모듈화 설계**: 각 컴포넌트별로 독립적인 모듈 구조

## 🔧 설정 옵션

### 리트리버 초기화 파라미터

- `meta_df`: 메타데이터 DataFrame
- `embedder`: 임베딩 모델 (HuggingFaceEmbeddings)
- `reranker`: 재순위화 모델 (CrossEncoder)
- `tokenizer`: 커스텀 토크나이저 (선택적)
- `persist_directory`: 벡터 DB 저장 경로
- `rerank_max_length`: 재순위화 최대 길이 (기본값: 512)
- `debug_mode`: 디버그 모드 활성화
- `tokenizer_engine`: 토크나이저 엔진 ("kiwi" 또는 "okt")

### 검색 파라미터

- `top_k`: 최종 반환할 문서 수
- `candidate_size`: 후보 문서 수 (재순위화 이전)
- `bm25_weight`: BM25 점수 가중치
- `rerank_weight`: 재순위화 점수 가중치

## 📊 지원하는 필터 유형

시스템이 자동으로 인식하는 필터 조건들:

- **사업금액**: "5천만원 이상", "1억원 이하" 등
- **입찰일자**: "2024년 3월 이후", "2023년 12월까지" 등  
- **발주기관**: "조달청", "한국농어촌공사" 등
- **공고번호**: 특정 공고번호 패턴

### 필터 연산자

- `=`: 정확히 일치
- `>=`, `>`: 크거나 같음, 초과
- `<=`, `<`: 작거나 같음, 미만
- `~`: 근사치 (±10%)

## 🧩 모듈별 상세 기능

### TokenizerWrapper
- Kiwi, KoNLPy 통합 지원
- 바이그램 자동 생성
- 불용어 제거

### DocumentLoader
- 비동기 JSON 파일 로딩
- 중복 문서 자동 제거
- 캐싱 지원

### VectorDBManager  
- ChromaDB 기반 벡터 저장
- 배치 처리 지원
- 증분 업데이트

### BM25Manager
- 한국어 최적화된 BM25
- 인덱스 저장/로드
- 필터링 지원

### SearchEngine
- 하이브리드 검색 조합
- 점수 정규화
- 고급 필터링

## 🔍 검색 알고리즘

1. **벡터 유사도**: 의미적 유사성 기반 검색
2. **BM25**: 키워드 기반 통계적 검색  
3. **재순위화**: CrossEncoder를 이용한 정밀 순위 조정
4. **점수 결합**: 가중평균을 통한 최종 점수 계산

## 📈 성능 최적화 팁

1. **캐싱 활용**: 문서와 인덱스 캐싱으로 재시작 시간 단축
2. **배치 처리**: 대용량 문서를 배치 단위로 처리
3. **필터 우선화**: 단순 필터를 먼저 적용하여 검색 범위 축소
4. **GPU 사용**: CUDA 가능 시 자동으로 GPU 활용

## 🐛 디버깅

## 📝 예제 쿼리

💡 더 정확한 검색을 위해 ‘발주기관’을 함께 입력해 주세요.

### [→ 하이브리드 검색 예시]

- “서울특별시 공공데이터 개방이나 연계 관련해서 어떤 요구사항이 있어?”
- "지도 시각화 기능 있는 공고 알려줘"
- "졸업요건 관리 기능이 포함된 공고 찾아줘"
- "졸업요구조건 증빙 제출관련 정보 알려줘"
- "졸업유예나 이의신청 처리 관련한 내용 알려줘"
- "고려대학교 졸업확정처리 관련해서 알려줘"
- "교직이수 포기 신청 관련정보 알려줘"

### [→ 메타데이터 검색 예시]

- "기초과학연구원 공고 사업금액 알려줘"
- "기초과학연구원 공고 입찰 시작일 알려줘"
- "사업금액이 7억 이상인 공고 알려줘"
- "입찰 시작일이 2024년 7월 이후인 공고 알려줘"
- "고려대학교 학사 정보시스템 공고 요약해줘"
